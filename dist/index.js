(function(p,S){typeof exports=="object"&&typeof module!="undefined"?S(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],S):(p=typeof globalThis!="undefined"?globalThis:p||self,S(p.FmmVue={},p.Vue))})(this,function(p,S){"use strict";function _(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var u=_(S);class L{constructor(){this.minimaps=new Set}notifyMinimapOnUpdate(t,i){i?this.minimaps.add(t):this.minimaps.delete(t)}notifyMinimaps(){const t=new Set;this.minimaps.forEach(i=>i.takeSnapshot()||t.add(i)),t.forEach(i=>this.minimaps.delete(i))}}class D extends L{constructor(t,i){super();this.values=t,this.errors=i||{},this.values=t||{}}createStoreItem(t,i){for(const s of t.getStoreKeys(i))if(s&&s in this.values)return new H(i,s)}getError(t,i,s){const n=this.errors[i.key];return Array.isArray(n)?n.length?String(n[0]):"":n?String(n):""}getName(t,i){return i.key}getValue(t,i){return this.values[i.key]}isDisabled(t,i){return t.isDisabled(i.e)}update(t,i){this.errors=i||{},this.values=t||{},super.notifyMinimaps()}}class H{constructor(t,i){this.e=t,this.key=i}destructor(){}}const y=class{constructor(e,t){this.form=e,this.resizeObserver=new ResizeObserver(this.onFormResize.bind(this)),this.page=t||e,this.resizeObserver.observe(e),this.updateLayoutOnScroll=this.updateLayoutOnScroll.bind(this),this.page.addEventListener("scroll",this.updateLayoutOnScroll,!0)}clearLayoutHandler(){this.resizeObserver.disconnect(),this.page.removeEventListener("scroll",this.updateLayoutOnScroll,!0),this.layoutHandler=void 0}clipsContentX(e){const{overflow:t,overflowX:i}=e.style;return y.CLIP.includes(t)||y.CLIP.includes(i)}clipsContentY(e){const{overflow:t,overflowY:i}=e.style;return y.CLIP.includes(t)||y.CLIP.includes(i)}getDisplayLabel(e,t){return t?.getAttribute("aria-label")||t?.textContent||e.getAttribute("aria-label")||e.id}getDisplayValue(e,t,i){const s=e.tagName;if(s==="INPUT"){const n=e;return n.type==="checkbox"||n.type==="radio"?n.checked?t:"":n.type==="password"?"*****":String(i)}if(s==="SELECT"){const n=Array.isArray(i)?i:[i];if(!n.length)return String(i);const a=e.options;return typeof n[0]=="number"?n.map(r=>a[r].text).join(`
`):Array.from(a).filter(r=>n.includes(r.value)).map(r=>r.text).join(`
`)}return String(i)}getElements(e){const t=Array.from(this.form.elements);return e.length&&t.push(...Array.from(this.page.querySelectorAll("#"+e.join(",#")))),t}getLabelFor(e){let t=e.id?this.page.querySelector("label[for="+e.id+"]"):void 0;return!t&&e.parentElement?.tagName==="LABEL"&&(t=e.parentElement),!t&&e.previousElementSibling?.tagName==="LABEL"&&(t=e.previousElementSibling),t}getParent(e){return e.parentElement}getPlaceholder(e){return e.getAttribute("placeholder")||""}getRect(e){return(e||this.page).getBoundingClientRect()}getStoreKeys(e){const t=e.getAttribute("name");return t?[t,e.id]:[e.id]}isDisabled(e){if(e.tagName!=="TEXTAREA")return e.disabled;const t=e;return t.disabled||t.readOnly}isHidden(e){return e.hidden}setLayoutHandler(e){this.layoutHandler=e}onFormResize(){this.layoutHandler&&this.layoutHandler.handleLayout()}updateLayoutOnScroll(e){e.target instanceof HTMLElement&&this.layoutHandler&&this.layoutHandler.handleLayout(e.target)}};let M=y;M.CLIP=["auto","hidden","scroll"];class q{constructor(t){if(this.wrapperClass=t,!t)throw new Error("FmmFrameworkItemBase requires wrapperClass")}destructor(){}getEnvelope(t,i,s){let n=i.parentElement;for(;n&&n.tagName!=="FORM"&&!n.classList.contains(this.wrapperClass);)n=n.parentElement;if(n&&n.tagName!=="FORM")return n;if(s){for(n=s.parentElement;n&&n.tagName!=="FORM"&&!n.classList.contains(this.wrapperClass);)n=n.parentElement;return n&&n.tagName!=="FORM"?n:void 0}}getError(t,i,s,n){return""}getLabel(t,i){return i.querySelector("LABEL")||i.querySelector("[aria-label]")}getValue(t,i,s,n){return""}}const A=class extends L{constructor(){super(...arguments);this.listener=this.notifyMinimaps.bind(this)}createStoreItem(e,t){const i=t.tagName;if(i==="INPUT"){const s=t;return A.INPUTTYPES.includes(s.type)?new j(s,this.listener):void 0}if(i==="SELECT")return new W(t,this.listener);if(i==="TEXTAREA")return new $(t,this.listener)}getError(e,t,i){return t.fe.validationMessage||t.fe.required&&!t.fe.value&&"Required"||""}getName(e,t){return t.fe.name}getValue(e,t){return t.getValue()}isDisabled(e,t){return e.isDisabled(t.fe)}};let I=A;I.INPUTTYPES=["checkbox","color","date","datetime","datetime-local","email","month","number","password","radio","range","search","tel","text","time","url","week"];class k extends q{constructor(t){super(t)}getError(t,i,s,n){if(!i.classList.contains("is-invalid"))return"";for(let a=i.nextElementSibling;a&&a!==i;a=a.nextElementSibling)if(a.classList.contains("invalid-feedback"))return a.textContent||"";return""}}new k("form-check"),new k("form-group");class E{constructor(t,i,s){this.fe=t,this.event=i,this.listener=s,t.addEventListener(i,s)}destructor(){this.fe.removeEventListener(this.event,this.listener)}getValue(){return this.fe.value||void 0}isDisabled(){return this.fe.disabled}}class j extends E{constructor(t,i){super(t,"input",i)}}class W extends E{constructor(t,i){super(t,"change",i);this.e=t,this.isMultiple=t.multiple}getValue(){const t=this.e.selectedIndex;if(t<0)return;if(!this.isMultiple)return[t];const i=[],s=this.e.options;for(let n=s.length;--n>=t;)s[n].selected&&i.push(n);return i.reverse()}}class $ extends E{constructor(t,i){super(t,"input",i);this.e=t}}class l{static createMinimap(t,i){if(!t.anchor)throw new Error("FmmMinimap not created: invalid anchor");return new P(i).createMinimap({...t,ordinal:0,usePanelDetail:!1})}static createPanel(t,i,s,n,a){const r="FmmPanel not created: invalid ";if(!t)throw new Error(r+"parent");if(i<1||i>20)throw new Error(r+"minimapsCount");return new P(a,i,!!n,t,s)}static trim(t){return t?.trim().replace(/\u200B/g,"")}}l.CLASS=Object.freeze({Detached:"fmm-detached",DetailPopup:"fmm-detail",Disabled:"fmm-disabled",Error:"fmm-error",Fieldset:"fmm-fieldset",Header:"fmm-header",Invalid:"fmm-invalid",Legend:"fmm-legend",MinimapFrame:"fmm-frame",MinimapPopup:"fmm-popup",Optional:"fmm-optional",Pushpin:"fmm-pushpin",Required:"fmm-required",Title:"fmm-title",Valid:"fmm-valid",Value:"fmm-value"}),l.CSS=`
	circle.fmm-pushpin {
		fill: blue;
	}
	div.fmm-detail,
	div.fmm-popup {
		background-color: darkgray;
		border: 1px solid black;
		box-shadow: 5px 5px lightgray;
		padding-top: 10px;
		z-index: 1;
	}
	div.fmm-disabled {
		background-color: darkgray;
	}
	div.fmm-disabled,
	div.fmm-invalid,
	div.fmm-optional,
	div.fmm-required,
	div.fmm-valid {
		border: 1px solid transparent;
	}
	div.fmm-frame {
		background-color: white;
	}
	div.fmm-header {
		border-bottom: 5px groove;
		margin: 0;
	}
	div.fmm-invalid {
		background-color: red;
	}
	div.fmm-optional {
		border-color: black;
	}
	div.fmm-required {
		border-color: red;
	}
	div.fmm-valid {
		background-color: green;
	}
	fieldset.fmm-fieldset {
		background-color: white;
		border-top: 5px groove;
		min-width: 0;
		padding: 5px 10px;
	}
	fieldset.fmm-fieldset div.fmm-disabled,
	fieldset.fmm-fieldset div.fmm-invalid,
	fieldset.fmm-fieldset div.fmm-optional,
	fieldset.fmm-fieldset div.fmm-required,
	fieldset.fmm-fieldset div.fmm-valid {
		border-width: 2px;
	}
	label.fmm-title {
		font-size: smaller;
		padding: 2px;
	}
	legend.fmm-legend {
		background-color: white;
		margin: 5px;
		max-width: 100%;
		padding-right: 5px;
	}
	textarea.fmm-value {
		height: 3em;
		width: 100%;
	}
	div.fmm-detached.fmm-popup,
	div.fmm-detached div.fmm-detail {
		background-color: lightgray;
	}
	div.fmm-detached.fmm-frame,
	div.fmm-detached div.fmm-frame,
	div.fmm-detached fieldset.fmm-fieldset,
	iv.fmm-detached legend.fmm-legend {
		background-color: lightgray !important;
	}
	`,l.STATUS_CLASS=Object.freeze({Disabled:"fmm-disabled",Invalid:"fmm-invalid",Optional:"fmm-optional",Required:"fmm-required",Valid:"fmm-valid"});class X{constructor(t,i,s){this.parent=s,this.clip=s?.clipRect(t.getRect(i))||t.getRect(i),this.clipX=t.clipsContentX(i),this.clipY=t.clipsContentY(i)}clipRect(t){const i=Math.max(t.left,this.clip.left),s=Math.max(t.top,this.clip.top),n=Math.max(0,(this.clipX?Math.min(t.right,this.clip.right):t.right)-i),a=Math.max(0,(this.clipY?Math.min(t.bottom,this.clip.bottom):t.bottom)-s),r={left:i,top:s,width:n,height:a,right:i+n,bottom:s+a};return n&&a&&this.parent?this.parent.clipRect(r):r}}class Z{constructor(t,i){this.debounceMsec=t,this.task=i,this._doTask=this.doTask.bind(this),this.notBeforeMsec=0}destructor(){!this.task||(this.timer&&window.clearTimeout(this.timer),this.timer=void 0)}cancel(){return this.timer?(window.clearTimeout(this.timer),this.timer=void 0,!0):!1}doNow(){!this.task||(this.cancel(),this.task())}schedule(){!this.task||(this.notBeforeMsec=Date.now()+this.debounceMsec,this.timer||(this.timer=window.setTimeout(this._doTask,this.debounceMsec)))}doTask(){const t=this.notBeforeMsec-Date.now();t>0?this.timer=window.setTimeout(this._doTask,t):(this.timer=void 0,this.task())}}class x{constructor(t,i){this.data=f.NULLDATA,this.minimapId=0;const s=this.e=t.createElement("FIELDSET");s.className=l.CLASS.Fieldset;const n=m.ELLIPSIS(t.createElement("LEGEND"));n.className=l.CLASS.Legend,this.status=n.appendChild(t.createElement("DIV")),this.status.style.display="inline-block",this.status.style.margin="3px 6px 0 3px",this.status.style.height="0.7em",this.status.style.width="1em",this.label=n.appendChild(t.createElement("SPAN")),this.label.textContent=m.NBSP,s.appendChild(n),this.value=s.appendChild(t.createElement("TEXTAREA")),this.value.className=l.CLASS.Value,this.value.readOnly=!0,this.error=m.ELLIPSIS(s.appendChild(t.createElement("DIV"))),this.error.className=l.CLASS.Error,this.error.textContent=m.NBSP,i&&i.appendChild(s)}destructor(){this.e.parentElement&&this.e.parentElement.removeChild(this.e)}clear(t){t&&t!==this.data||(this.error.textContent=this.label.textContent=m.NBSP,this.status.className=this.value.placeholder=this.value.value="",this.data=f.NULLDATA)}refreshDisplay(t){if(t!==this.minimapId)return;const i=this.data,s=i.aggregateLabel?.concat(": ")||"";this.error.textContent=this.error.title=i.error||m.NBSP,this.label.textContent=this.label.title=s+i.label||m.NBSP,this.status.className=l.STATUS_CLASS[i.status],this.value.placeholder=i.placeholder||"",this.value.value=i.aggregateValues?.join(`
`)||i.value||""}setDisplay(t,i){this.data=i||f.NULLDATA,this.refreshDisplay(this.minimapId=t)}}const N=class{constructor(e,t,i,s){this.e=t,this.storeItem=i;const n=s.form.getLabelFor(t);this.dynamicLabel=s.dynamicLabels.includes(e),this.form=s.form,this.framework=s.framework?.createFrameworkItem(e,t)||N.DEFAULT_FRAMEWORK,this.envelope=this.framework.getEnvelope(e,t,n)||this.getCommonAncestor(t,n)||t,this.label=n||this.framework.getLabel(e,this.envelope),this.snapshot=new f(e,s)}destructor(){this.framework.destructor(),this.storeItem.destructor()}layoutSnapshot(e,t,i){const s=this.form.getParent(this.envelope);if(!s)return this.snapshot.setRect();const n=(e.get(s)||this.getClipContext(s,e)).clipRect(this.form.getRect(this.envelope));if(!n.width||!n.height)return this.snapshot.setRect();const a=Math.floor((n.left-t.left)*i),r=Math.floor((n.top-t.top)*i),o=Math.max(2,Math.floor(n.height*i)),h=Math.max(2,Math.floor(n.width*i));return this.snapshot.setRect(new DOMRectReadOnly(a,r,h,o))}removeIfDetached(){if(this.form.getParent(this.envelope)){for(let e=this.e;e;e=this.form.getParent(e))if(e===this.envelope)return!1}return this.snapshot.destructor(),this.destructor(),!0}takeSnapshot(e,t){const i=this.snapshot.data,s=i.name;(!i.label||this.dynamicLabel)&&(i.label=l.trim(e.getDisplayLabel(this.e,this.label)||s),i.placeholder=l.trim(this.form.getPlaceholder(this.e)));let n=l.trim(this.framework.getValue(s,this.e,this.envelope,i.label));if(!n){const r=t.getValue(e,this.storeItem);r&&(n=l.trim(e.getDisplayValue(this.e,i.label,r)))}i.value=n;const a=!!n;return a&&i.aggregateValues&&i.aggregateValues.push(n),i.error=l.trim(this.framework.getError(s,this.e,this.envelope,a)||t.getError(e,this.storeItem,a)),t.isDisabled(e,this.storeItem)?this.snapshot.setStatus("Disabled"):a?this.snapshot.setStatus(i.error?"Invalid":"Valid"):this.snapshot.setStatus(i.error?"Required":"Optional"),i}getClipContext(e,t){const i=this.form.getParent(e),s=i?t.get(i)||this.getClipContext(i,t):void 0,n=new X(this.form,e,s);return t.set(e,n),n}getCommonAncestor(e,t){const i=[];for(;t;t=this.form.getParent(t))i.push(t);for(;e&&!i.includes(e);)e=this.form.getParent(e);return e}};let O=N;O.DEFAULT_FRAMEWORK={destructor:()=>{},getEnvelope:(e,t,i)=>{},getError:(e,t,i,s)=>"",getLabel:(e,t)=>{},getValue:(e,t,i,s)=>""};const T=class{constructor(){this.list=[],this.ignore=new WeakSet,this.nameCounter=0}destructor(){this.ignore=new WeakSet,this.list.splice(0).forEach(e=>e.destructor())}compose(e){const t=e.form.getElements(e.customElementIds);this.list.splice(0).forEach(s=>s.removeIfDetached()||this.list.push(s));const i=new WeakSet;this.list.forEach(s=>i.add(s.e)),t.forEach(s=>{if(i.has(s)||this.ignore.has(s))return;if(e.form.isHidden(s))return this.ignore.add(s);const n=e.store.createStoreItem(e.form,s);if(n){const a=e.store.getName(e.form,n)||T.NAMEPREFIX+String(this.nameCounter++);this.list.push(new O(a,s,n,e))}i.add(s)})}layoutSnapshots(e,t,i){this.list.forEach(s=>s.layoutSnapshot(e,t,i))}takeSnapshots(e,t){return this.list.map(i=>i.takeSnapshot(e,t))}};let F=T;F.NAMEPREFIX="$FmmFSI";const V=class{constructor(e,t,i,s){this.dragData="";const n=this.div=e.createElement("DIV");n.className=l.CLASS.MinimapFrame,n.draggable=!0,n.ondragstart=this.onDragStart.bind(this),n.style.cursor="grab",n.style.position="relative";const a=this.header=n.appendChild(e.createElement("DIV"));a.className=l.CLASS.Header,a.style.overflow="hidden",a.style.whiteSpace="nowrap";const r=m.ELLIPSIS(e.createElement("LABEL"));r.className=l.CLASS.Title,r.style.cursor="inherit",r.textContent=r.title=i;const o=t.style;if(s){o.position="absolute",o.top=o.bottom=o.left=o.right="0",V.POSITIONS.includes(s.style.position)||(s.style.position="relative"),s.appendChild(t),this.popup=new C(e,l.CLASS.MinimapPopup,this.div,t);let h=t.previousElementSibling;for(;h&&!h.className.includes("fmm-");)h=h.previousElementSibling;h&&s.removeChild(h),this.setDestroyOnDetachFromDOM(s,t)}else a.appendChild(t),o.display="inline-block",o.margin="1px 2px 0 1px",o.height="0.5em",o.width="0.8em";a.appendChild(r)}destructor(){!this.div.parentElement||(this.detach(),this.popup&&this.popup.destructor(),this.popup=void 0,this.div.onmouseenter=this.div.onmouseleave=null,this.div.parentElement?.removeChild(this.div))}detach(){this.popup?this.div.parentElement?.classList.add(l.CLASS.Detached):this.div.classList.add(l.CLASS.Detached)}newDetailPopup(e,t){return new C(e,l.CLASS.DetailPopup,t.e,this.div)}setSnapshotResult(e){this.dragData=JSON.stringify(e)}onDragStart(e){e.dataTransfer?.setData("text/plain",this.dragData)}setDestroyOnDetachFromDOM(e,t){new MutationObserver((i,s)=>{t.parentElement!==e&&(s.disconnect(),this.destructor())}).observe(e,{childList:!0})}};let R=V;R.POSITIONS=["absolute","fixed","relative","sticky"];const m={ELLIPSIS:e=>(e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e),NBSP:"\xA0",NOP:()=>{}},b=class{constructor(e,t){this.onUpdateBeingCalled=!1,this.pendingCompose=!1,this.pendingLayout=!1,this.pendingSnapshot=!1;const i=t.ef,s=i.createElement("DIV");this.ordinal=e.ordinal||0,this.summaryData={...f.NULLDATA,label:e.title},this.title=e.title;const n=new R(i,s,this.title,e.anchor);t.add(this,e.anchor?void 0:n.div),n.div.onmouseenter=this.onFrameEnter.bind(this),n.div.onmouseleave=this.onFrameLeave.bind(this),e.anchor&&e.zoomFactor&&n.popup&&n.popup.setZoomable(this,n.header,Math.min(b.MAX_ZOOMFACTOR,Math.max(0,e.zoomFactor))),n.header.onmouseenter=this.onHeaderEnter.bind(this);const a=new K(i,n.div);this.minimapId=b.idCounter++,this.useWidthToScale=!!e.useWidthToScale,this.verbosity=e.verbosity||0,this.d={clipContextAncestors:new WeakMap,doUpdates:new Z(e.debounceMsec||b.DEFAULT_DEBOUNCEMSEC,()=>this.doPendingUpdates()),onUpdate:e.onUpdate||b.ONUPDATE,paramUpdates:{aggregateLabels:e.aggregateLabels||{},aggregateValuesMap:{},customElementIds:[],dynamicLabels:e.dynamicLabels||[],ef:t.ef,form:e.form,framework:e.framework,snapshotUpcall:{hideDetail:this.snapshotHidden.bind(this),showDetail:this.snapshotActive.bind(this)},snapshotsPanel:a,store:e.store||new I},storeItems:new F};const r=e.usePanelDetail&&t.detail||new x(i);this.z={detail:r,detailPopup:r===t.detail?void 0:e.anchor?n.newDetailPopup(i,r):t.newDetailPopup(r),frame:n,panel:t,pin:new Y(i,n.div),snapshotsPanel:a,status:s},e.anchor&&(s.onmouseover=this.onStatusEnter.bind(this)),this.d.paramUpdates.store.notifyMinimapOnUpdate(this,!0),this.d.paramUpdates.form.setLayoutHandler(this)}static ONUPDATE(e){}destructor(){this.detach();const e=this.z;!e||(this.z=void 0,e.status.parentElement?.removeChild(e.status),e.snapshotsPanel.destructor(),e.pin.destructor(),e.frame.destructor(),e.detail.clear(this.activeSnapshot),e.detail!==e.panel.detail&&e.detail.destructor(),e.detailPopup&&e.detailPopup.destructor(),e.panel.remove(this))}compose(e){!this.d||(this.d.paramUpdates.customElementIds=e||[],this.pendingCompose=this.pendingLayout=!0,this.takeSnapshot())}get isDetached(){return this.d===void 0}get isPinned(){return this.z?.pin.isPinned}get isPinnedToPanelDetail(){return this.isPinned&&this.z?.detail===this.z?.panel.detail}detach(){const e=this.d,t=this.z;!e||!t||(this.d=void 0,e.doUpdates.destructor(),this.pendingCompose=this.pendingLayout=!1,this.pendingSnapshot=!0,this.doPendingUpdates(),t.frame.detach(),e.paramUpdates.form.clearLayoutHandler(),e.paramUpdates.store.notifyMinimapOnUpdate(this,!1),e.storeItems.destructor())}handleLayout(e){(!e||this.d?.clipContextAncestors.has(e))&&(this.pendingLayout=!0,this.d?.doUpdates.schedule())}layout(e){const t=this.d,i=this.z;if(!t||!i)return;const s=e&&this.verbosity?Date.now():0,n=t.paramUpdates.form.getRect();if(n?.height&&n.width){t.clipContextAncestors=new WeakMap;const a=i.snapshotsPanel.computeScale(n,i.frame,this.useWidthToScale);i.snapshotsPanel.show(!1),t.storeItems.layoutSnapshots(t.clipContextAncestors,n,a),i.snapshotsPanel.show(!0),e&&(i.pin.trackOff(i.frame),i.pin.trackOn(i.snapshotsPanel,e))}e&&this.verbosity&&console.log("FormMinimap["+this.title+"] Layout(ms)="+String(Date.now()-s))}notifyMinimap(e,t){}onFrameEnter(e){const t=this.z;!t||(this.isPinned||t.pin.trackOn(t.snapshotsPanel,e),this.activeSnapshot&&t.detail.setDisplay(this.minimapId,this.activeSnapshot),this.showPopups())}onFrameLeave(){const e=this.z;!e||this.isPinned||(e.pin.trackOff(e.frame),e.detail.clear(this.activeSnapshot),e.detailPopup?e.detailPopup.hide():e.panel.hideDetailPopup(),e.frame.popup&&e.frame.popup.hide())}onHeaderEnter(e){e.stopPropagation(),!(!this.z||this.isPinned)&&(this.activeSnapshot=void 0,this.z.detail.setDisplay(this.minimapId,this.summaryData))}onStatusEnter(e){e.stopPropagation(),this.z?.frame.popup?.isShowing||this.showPopups()}takeSnapshot(){return this.d?(this.pendingSnapshot=!0,this.d.doUpdates.schedule(),!0):!1}doTakeSnapshot(){const e=this.d,t=this.z;if(!e||!t)return{snapshots:[],status:"Disabled",title:this.title};const i=e.paramUpdates,s=Object.values(i.aggregateValuesMap);s.forEach(o=>o.splice(0));const n=e.storeItems.takeSnapshots(i.form,i.store);s.forEach(o=>o.sort());const a=t.snapshotsPanel.computeStatus();t.status.className=l.STATUS_CLASS[a];const r={};return a!=="Disabled"&&n.filter(o=>o.error&&o.status===a).forEach(o=>r[o.aggregateLabel||o.label]=o.error),this.summaryData.aggregateValues=Object.keys(r).sort().map(o=>o+": "+r[o]),this.summaryData.status=a,{snapshots:n,status:a,title:this.title}}doPendingUpdates(){const e=this.d,t=this.z;if(!e||!t)return;const i=this.verbosity?Date.now():0;this.pendingCompose&&e.storeItems.compose(e.paramUpdates);const s=this.verbosity?Date.now():0;this.pendingLayout&&this.layout();const n=this.verbosity?Date.now():0;let a=n;if(this.pendingSnapshot){const r=this.doTakeSnapshot();t.frame.setSnapshotResult(r),this.verbosity&&(a=Date.now()),t.detail.refreshDisplay(this.minimapId),this.onUpdateBeingCalled||(this.onUpdateBeingCalled=!0,e.onUpdate(r),this.onUpdateBeingCalled=!1)}if(this.verbosity){const r=this.pendingCompose?" Compose(ms)="+String(s-i):"",o=this.pendingLayout?" Layout(ms)="+String(n-s):"",h=this.pendingSnapshot?" Snapshot(ms)="+String(a-n):"";(r||o||h)&&console.log("FormMinimap["+this.title+"]"+r+o+h)}this.pendingCompose=this.pendingLayout=this.pendingSnapshot=!1}showPopups(){const e=this.z;!e||(this.d&&this.d.doUpdates.doNow(),e.frame.popup&&e.frame.popup.show(!0),e.detailPopup?e.detailPopup.show(!1):e.panel.showDetailPopup())}snapshotActive(e){this.isPinned||this.z?.detail.setDisplay(this.minimapId,this.activeSnapshot=e)}snapshotHidden(e,t){const i=this.z;!i||(this.activeSnapshot===t&&(this.activeSnapshot=void 0),i.detail.clear(t),i.pin.trackOff(i.frame,e))}};let w=b;w.DEFAULT_DEBOUNCEMSEC=200,w.MAX_ZOOMFACTOR=5,w.idCounter=0;const U=class{constructor(e=U.EF,t=1,i=!1,s,n){if(this.ef=e,this.minimapsCount=t,this.vertical=i,this.minimaps=[],s){this.detail=new x(this.ef,n),this.popupParent=s.appendChild(this.ef.createElement("DIV"));const a=this.popupParent.style;a.position="relative",n||(this.detailPopup=this.newDetailPopup(this.detail)),this.div=s.appendChild(this.ef.createElement("DIV")),this.div.style.height=this.div.style.width="100%",this.div.style.overflow="hidden",this.div.style.position="relative"}}destructor(){this.detail&&this.detail.destructor(),this.detailPopup&&this.detailPopup.destructor(),this.minimaps.splice(0).forEach(e=>e.destructor())}add(e,t){if(t&&this.div){this.div.appendChild(t),t.style.position="absolute";const i=100/this.minimapsCount;this.vertical?(t.style.top=String(e.ordinal*i)+"%",t.style.height=String(i*.9)+"%",t.style.right=t.style.left="0"):(t.style.left=String(e.ordinal*i)+"%",t.style.width=String(i*.9)+"%",t.style.top=t.style.bottom="0")}this.minimaps[e.ordinal]&&this.minimaps[e.ordinal].destructor(),this.minimaps[e.ordinal]=e}createMinimap(e){const t="FmmMinimap <"+e.title+"> not created: invalid ";if(!e.form)throw new Error(t+"form");if(e.ordinal&&e.ordinal>=this.minimapsCount)throw new Error(t+"ordinal");return new w(e,this)}destroyDetached(){this.minimaps.filter(e=>e.isDetached).forEach(e=>e.destructor())}hideDetailPopup(){this.detailPopup&&!this.minimaps.find(e=>e.isPinnedToPanelDetail)&&this.detailPopup.hide()}newDetailPopup(e){return this.popupParent?new C(this.ef,l.CLASS.DetailPopup,e.e,this.popupParent):void 0}remove(e){delete this.minimaps[e.ordinal]}showDetailPopup(){this.detailPopup&&this.detailPopup.show(!1)}};let P=U;P.EF={createElement:e=>document.createElement(e),createElementNS:(e,t)=>document.createElementNS(e,t)};class C{constructor(t,i,s,n){this.div=n.appendChild(t.createElement("DIV")),this.div.className=i,this.div.style.display="none",this.div.style.position="absolute",this.div.appendChild(s),n.style.overflow="visible",s.style.display="block",s.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div)}get isShowing(){return this.div.style.display!=="none"}getElementSize(t){const i=this.div.style;if(i.display!=="none"){const a=this.div.getBoundingClientRect(),r=t.getBoundingClientRect();return[a.height-(r.top-a.top),a.width-(r.left-a.left)]}i.visibility="hidden",i.display="block";const s=this.div.getBoundingClientRect(),n=t.getBoundingClientRect();return i.display="none",i.visibility="visible",[s.height-(n.top-s.top),s.width-(n.left-s.left)]}hide(){this.div.style.display="none"}setZoomable(t,i,s){let n=!1,a=0,r=0;i.style.cursor="zoom-in",i.onclick=o=>{if(o.button===0){if(o.stopPropagation(),!a){const h=this.div.getBoundingClientRect();a=h.height,r=h.width}t.useWidthToScale?this.div.style.width=String(n?r:r*s)+"px":this.div.style.height=String(n?a:a*s)+"px",t.layout(o),n=!n,i.style.cursor=n?"zoom-out":"zoom-in"}}}show(t){const i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=Math.max(document.documentElement.clientWidth,window.innerWidth||0),n=this.div.style;if(n.display!=="none")return;n.left=n.bottom="auto",n.right=t?"50%":"105%",n.top=t?"50%":"0",n.visibility="hidden",n.display="block";const a=this.div.getBoundingClientRect();if(a.left<0){n.left=t?"50%":"105%",n.right="auto";const r=this.div.getBoundingClientRect();s-r.left-r.width<a.left&&(n.left="auto",n.right=t?"50%":"105%")}if(a.bottom>i){n.bottom=t?"50%":"0",n.top="auto";const r=this.div.getBoundingClientRect();r.top+r.height-i>a.bottom&&(n.bottom="auto",n.top=t?"50%":"0")}n.visibility="visible"}}class Y{constructor(t,i){this.SIZE=24,this.parentCursor="none",this.pinned=!1;const s="http://www.w3.org/2000/svg",n=i.appendChild(t.createElementNS(s,"svg"));this.svg=n,i.style.overflow="visible",n.setAttribute("height",String(this.SIZE)),n.setAttribute("width",String(this.SIZE));const a=this.SIZE/4,r=n.appendChild(t.createElementNS(s,"circle"));r.setAttribute("class",l.CLASS.Pushpin),r.setAttribute("cx",String(this.SIZE-a)),r.setAttribute("cy",String(a)),r.setAttribute("r",String(a));const o=n.appendChild(t.createElementNS(s,"polygon"));[[this.SIZE/2+1,Math.ceil(a*1.5)],[0,this.SIZE],[Math.ceil(this.SIZE*.6),a*2-1]].forEach(([h,c])=>{const g=this.svg.createSVGPoint();g.x=h,g.y=c,o.points.appendItem(g)}),o.setAttribute("style","fill:black"),n.style.display="none",n.style.position="absolute"}destructor(){this.trackOff()}get isPinned(){return this.pinned}trackOff(t,i){const s=this.svg.parentNode;i&&i!==s||(this.pinned=!1,this.svg.style.display="none",s.onclick=s.onmousemove=null,s.style.cursor=this.parentCursor,t?t.div.appendChild(this.svg):s.removeChild(this.svg))}trackOn(t,i){const s=this.svg.parentNode,n=s.getBoundingClientRect();s.appendChild(this.svg),this.parentCursor=s.style.cursor,this.svg.style.zIndex=String(+s.style.zIndex+1),s.onclick=a=>{if(a.button===0)if(this.pinned)this.pinned=!1,s.style.cursor="none",s.appendChild(this.svg),this.move(a,n);else{if(this.pinned=!0,s.style.cursor=this.parentCursor,t.reparentPushPinToSnapshot(this.svg,a))return;const r=Math.max(1,(a.clientX-n.left)*100/n.width);this.svg.style.left=String(r)+"%";const o=Math.min(95,(n.top+n.height-a.clientY)*100/n.height);this.svg.style.bottom=String(o)+"%"}},s.onmousemove=a=>this.move(a,n),this.move(i,n),s.style.cursor="none",this.svg.style.display="block"}move(t,i){if(this.pinned)return;const s=t.clientX-i.left,n=i.top+i.height-t.clientY;this.svg.style.left=String(Math.min(i.width,Math.max(s,0)))+"px",this.svg.style.bottom=String(Math.min(i.height,Math.max(n,0)))+"px"}}const z=class{constructor(e,t){const i=t.aggregateLabels[e];i&&!(e in t.aggregateValuesMap)&&(t.aggregateValuesMap[e]=[]),this.data={...z.NULLDATA,aggregateLabel:i,aggregateValues:t.aggregateValuesMap[e],name:e},this.upcall=t.snapshotUpcall,this.div=t.ef.createElement("DIV"),this.div.style.position="absolute",this.div.onmouseover=s=>{s.stopPropagation(),this.upcall.showDetail(this.data)},t.snapshotsPanel.addSnapshot(this,this.div),this.destructor=()=>{this.div.onmouseover=null,this.upcall.hideDetail(this.div,this.data),t.snapshotsPanel.removeSnapshot(this,this.div),this.destructor=m.NOP}}destructor(){}reparentPushPin(e,t,i){const s=this.rect;return!s||t<s.left||t>s.left+s.width||i<s.top||i>s.top+s.height?!1:(this.div.appendChild(e),e.style.left=String((t-s.left)*100/s.width)+"%",e.style.bottom=String((s.top+s.height-i)*100/s.height)+"%",!0)}setRect(e){if(this.rect&&e&&this.rect.left===e.left&&this.rect.top===e.top&&this.rect.right===e.right&&this.rect.bottom===e.bottom)return;this.rect=e;const t=this.div.style;return e?(t.left=String(e.left)+"px",t.top=String(e.top)+"px",t.height=String(e.height)+"px",t.width=String(e.width)+"px",t.display="block"):(this.upcall.hideDetail(this.div,this.data),t.display="none")}setStatus(e){this.div.className=l.STATUS_CLASS[this.data.status=e]}};let f=z;f.NULLDATA={aggregateLabel:"",aggregateValues:void 0,error:"",label:"",name:"",placeholder:"",status:"Optional",value:""};class K{constructor(t,i){this.list=[],this.div=i.appendChild(t.createElement("DIV")),this.div.style.position="relative"}destructor(){this.div.parentElement&&this.div.parentElement.removeChild(this.div),this.list.splice(0).forEach(t=>t.destructor())}addSnapshot(t,i){this.list.push(t),this.div.appendChild(i)}computeScale(t,i,s){if(!this.div.parentElement)return 0;const[n,a]=i.popup?i.popup.getElementSize(this.div):this.getSize(),r=n/t.height,o=a/t.width,h=this.div.parentElement.style,c=this.div.style;if(i.popup||(s=t.height*o<=n),s){const v=String(Math.round(t.height*o))+"px";if(h.width=c.width=String(a)+"px",c.height=v,c.height===v)return o}else{const v=String(Math.round(t.width*r))+"px";if(c.height=String(n)+"px",h.width=c.width=v,h.width===v&&c.width===v)return r}const g=Math.min(r,o);return c.height=String(Math.round(t.height*g))+"px",h.width=c.width=String(Math.round(t.width*g))+"px",g}computeStatus(){let t="Disabled",i,s;const n=this.list;for(let a=n.length;--a>=0;){const r=n[a].data.status;if(r==="Invalid")return r;r!=="Disabled"&&(t=void 0),r==="Required"&&(i=r),r==="Valid"&&(s=r)}return i||t||s||"Optional"}removeSnapshot(t,i){const s=this.list.findIndex(n=>n===t);s<0||(this.list.splice(s,1),this.div.removeChild(i))}reparentPushPinToSnapshot(t,i){const s=this.div.getBoundingClientRect(),n=i.clientX-s.left,a=i.clientY-s.top;return!!this.list.find(r=>r.reparentPushPin(t,n,a))}show(t){this.div.style.display=t?"block":"none"}getSize(){const t=this.div.getBoundingClientRect();if(!this.div.parentElement)return[t.height,t.width];const i=this.div.parentElement.getBoundingClientRect();return[i.height-(t.top-i.top),i.width-(t.left-i.left)]}}const G=u.default.defineComponent({methods:{destructor(){return d.MINIMAPS.get(this)?.destructor()},takeSnapshot(){return d.MINIMAPS.get(this)?.takeSnapshot()}},mounted(){if(Object.keys(this.$slots).length)throw new Error("FmmVueMinimap is a contentless tag");let e=this.$el?.parentElement;for(;e&&e.tagName!=="FORM";)e=e.parentElement;if(!e)throw new Error("FmmVueMinimap must be used inside a FORM tag");const t={aggregateLabels:this.aggregateLabels,anchor:this.anchor,debounceMsec:this.debounceMsec,dynamicLabels:this.dynamicLabels,form:new M(e,this.page),framework:this.framework,onUpdate:s=>this.$emit("update",s),ordinal:this.ordinal,store:this.store,title:this.title,usePanelDetail:this.usePanelDetail,useWidthToScale:this.useWidthToScale,verbosity:this.verbosity,zoomFactor:this.zoomFactor},i=this.panel?d.PANELS.get(this.panel)?.createMinimap(t):l.createMinimap(t);!i||(d.MINIMAPS.set(this,i),i.compose(this.customElementIds),this.$watch("customElementIds",s=>i.compose(s)))},name:"FmmVueMinimap",props:{aggregateLabels:Object,anchor:HTMLDivElement,customElementIds:Array,debounceMsec:Number,dynamicLabels:Array,framework:Object,ordinal:Number,page:HTMLDivElement,panel:{type:Object,validator:e=>e.$options.name==="FmmVuePanel"},store:Object,title:{required:!0,type:String,validator:e=>e?.trim().length>0},usePanelDetail:Boolean,useWidthToScale:Boolean,verbosity:Number,zoomFactor:Number},render:()=>u.default.h("div"),unmounted(){const e=d.MINIMAPS.get(this);e&&e.detach(),d.MINIMAPS.delete(this)},updated(){this.$nextTick(()=>d.MINIMAPS.get(this)?.takeSnapshot())}}),J=u.default.defineComponent({methods:{destroyDetached(){const e=d.PANELS.get(this);e&&e.destroyDetached()}},mounted(){if(Object.keys(this.$slots).length)throw new Error("FmmVuePanel is a contentless tag");d.PANELS.set(this,l.createPanel(this.$el,this.minimapsCount,this.detailParent,this.vertical))},name:"FmmVuePanel",props:{detailParent:HTMLDivElement,minimapsCount:{required:!0,type:Number,validator:e=>e>0},vertical:Boolean},render:()=>u.default.h("div",{class:"fmm-panel"},[u.default.h("style",{tag:"component",attrs:{type:"text/css"}},l.CSS)]),unmounted(){const e=d.PANELS.get(this);e&&e.destructor(),d.PANELS.delete(this)}}),Q=u.default.defineComponent({data(){return{store:void 0}},emits:["store"],mounted(){if(Object.keys(this.$slots).length)throw new Error("FmmVueStore is a contentless tag");this.$emit("store",this.store=new D(this.values,this.errors))},name:"FmmVueStore",props:{errors:Object,values:{required:!0,type:Object}},render(){return null},watch:{errors:function(){this.store.update(this.values,this.errors)},values:function(){this.store.update(this.values,this.errors)}}}),tt=u.default.defineComponent({data(){return{$store:void 0,unsubscribeToStore:void 0,store:void 0}},emits:["store"],mounted(){if(Object.keys(this.$slots).length)throw new Error("FmmVuex is a contentless tag");this.$emit("store",this.store=new D(this.$store.state,this.errors)),this.unsubscribeToStore=this.$store.subscribe((e,t)=>this.store.update(t,this.errors))},name:"FmmVuex",props:{errors:Object},render(){return null},unmounted(){this.unsubscribeToStore()},watch:{errors:function(){this.store.update(this.$store.state,this.errors)}}}),d={MINIMAPS:new WeakMap,PANELS:new WeakMap},et={createFrameworkItem(e,t){return t.parentElement?.classList.contains("v-select__selections")?new it(t):new B(t)}};class B{constructor(t){const i=t.tagName==="INPUT"&&t.type==="radio";let s=t.parentElement;const n=i?"v-radio":"v-input";for(;s&&!s.classList.contains(n);)s=s.parentElement;if(!s)this.envelope=this.forValidation=t;else{this.envelope=s;const a=s.querySelectorAll("LABEL");if(a.length===1&&(this.label=a[0]),i)for(;s&&!s.classList.contains("v-input--radio-group");)s=s.parentElement;this.forValidation=s||this.envelope}}destructor(){}getEnvelope(t,i,s){return this.envelope}getError(t,i,s,n){return this.forValidation.querySelector("DIV.v-messages__message")?.textContent||""}getLabel(t,i){return this.label}getValue(t,i,s,n){return""}}class it extends B{getValue(t,i,s,n){return i.parentElement?.textContent||""}}p.FmmVueMinimap=G,p.FmmVuePanel=J,p.FmmVueStore=Q,p.FmmVuetify=et,p.FmmVuex=tt});
